apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# This overlay demonstrates using a Deployment instead of StatefulSet
# for Akka.NET clusters with reduced rebalancing overhead during updates

namespace: drawtogether

resources:
  - ../../base/configs/k8s-crd.yaml
  - ../../base/configs/k8s-rbac.yaml
  - ../../base/sql-server.yaml
  - ../../base/k8s-migrations-job.yaml
  - service.yaml
  - deployment.yaml

# Apply common labels
commonLabels:
  variant: deployment

# Ingress configuration
patchesStrategicMerge:
  - |-
    apiVersion: networking.k8s.io/v1
    kind: Ingress
    metadata:
      name: drawtogether-localhost
      namespace: drawtogether
      annotations:
        kubernetes.io/ingress.class: "nginx"
        nginx.ingress.kubernetes.io/affinity: "cookie"
        nginx.ingress.kubernetes.io/session-cookie-name: "route"
        nginx.ingress.kubernetes.io/session-cookie-hash: "sha1"
    spec:
      rules:
      - host: drawtogether.localdev.me
        http:
          paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: drawtogether
                port:
                  number: 8080
